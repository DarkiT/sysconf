# golangci-lint 配置文件
# 更多配置选项请参考: https://golangci-lint.run/usage/configuration/

run:
  # 超时时间
  timeout: 5m

  # 要检查的目录
  modules-download-mode: readonly

  # 跳过的目录
  skip-dirs:
    - bin
    - debug
    - vendor
    - .git
    - .codex
    - .claude
    - .cursor
    - .codebuddy

  # 跳过的文件
  skip-files:
    - ".*\\.pb\\.go$"
    - ".*_mock\\.go$"
    - ".*_test\\.go$"

# 输出配置
output:
  # 输出格式: colored-line-number|line-number|json|tab|checkstyle|code-climate
  format: colored-line-number

  # 打印检查器名称
  print-issued-lines: true
  print-linter-name: true
  uniq-by-line: true
  sort-results: true

# 启用的检查器
linters:
  enable:
    # 默认启用的检查器
    - errcheck # 检查未处理的错误
    - gosimple # 简化代码建议
    - govet # Go vet 检查
    - ineffassign # 检查无效赋值
    - staticcheck # 静态分析检查
    - typecheck # 类型检查
    - unused # 检查未使用的代码

    # 额外启用的检查器
    - gofmt # 检查代码格式
    - goimports # 检查导入格式
    - misspell # 检查拼写错误
    - unconvert # 检查不必要的类型转换
    - unparam # 检查未使用的参数
    - gocritic # Go 代码评审建议
    - gocyclo # 检查圈复杂度
    - dupl # 检查重复代码
    - goconst # 检查可以定义为常量的字符串
    - godot # 检查注释是否以句号结尾
    - gomnd # 检查魔法数字
    - gosec # 安全检查
    - lll # 检查行长度
    - nakedret # 检查裸返回
    - prealloc # 检查切片预分配
    - whitespace # 检查多余的空白字符

  disable:
    - deadcode # 已弃用，使用 unused 替代
    - varcheck # 已弃用，使用 unused 替代
    - structcheck # 已弃用，使用 unused 替代
    - scopelint # 已弃用，使用 exportloopref 替代

# 检查器配置
linters-settings:
  # errcheck 配置
  errcheck:
    # 检查类型断言
    check-type-assertions: true
    # 检查空白标识符
    check-blank: true
    # 忽略的函数调用
    ignore: fmt:.*,io/ioutil:^Read.*

  # gofmt 配置
  gofmt:
    # 简化代码
    simplify: true

  # goimports 配置
  goimports:

  # govet 配置
  govet:
    # 检查影子变量
    check-shadowing: true
    # 启用所有检查
    enable-all: true

  # gocyclo 配置
  gocyclo:
    # 圈复杂度阈值
    min-complexity: 15

  # lll 配置
  lll:
    # 行长度限制
    line-length: 120

  # misspell 配置
  misspell:
    # 语言设置
    locale: US

  # nakedret 配置
  nakedret:
    # 最大函数行数
    max-func-lines: 30

  # goconst 配置
  goconst:
    # 最小字符串长度
    min-len: 3
    # 最小出现次数
    min-occurrences: 3

  # gomnd 配置
  gomnd:
    settings:
      mnd:
        # 忽略的数字
        ignored-numbers: 0,1,2,3
        # 忽略的函数
        ignored-functions: strings.SplitN,bytes.SplitN

  # gosec 配置
  gosec:
    # 严重性级别
    severity: medium
    # 置信度级别
    confidence: medium
    # 排除的规则
    excludes:
      - G204 # 子进程启动审计
      - G304 # 文件路径审计

  # gocritic 配置
  gocritic:
    # 启用的检查
    enabled-tags:
      - diagnostic
      - style
      - performance
      - experimental
    # 禁用的检查
    disabled-checks:
      - commentedOutCode
      - whyNoLint

  # dupl 配置
  dupl:
    # 重复代码阈值
    threshold: 100

  # prealloc 配置
  prealloc:
    # 简单循环
    simple: true
    # 范围循环
    range-loops: true
    # for 循环
    for-loops: false

# 问题配置
issues:
  # 排除默认的排除规则
  exclude-use-default: false

  # 最大问题数量，0 表示无限制
  max-issues-per-linter: 0
  max-same-issues: 0

  # 新代码检查
  new: false

  # 排除的问题
  exclude:
    # 排除某些检查器的特定问题
    - "Error return value of .((os\\.)?std(out|err)\\..*|.*Close|.*Flush|os\\.Remove(All)?|.*printf?|os\\.(Un)?Setenv). is not checked"
    - "exported (type|method|function) .* should have comment or be unexported"
    - "ST1000: at least one file in a package should have a package comment"

  # 排除规则
  exclude-rules:
    # 排除测试文件的某些检查
    - path: _test\.go
      linters:
        - gomnd
        - goconst
        - dupl
        - lll

    # 排除 main 包的某些检查
    - path: cmd/
      linters:
        - gomnd

    # 排除生成的文件
    - path: ".*\\.pb\\.go"
      linters:
        - lll
        - goconst

    # 排除 mock 文件
    - path: ".*_mock\\.go"
      linters:
        - gomnd
        - goconst
        - dupl

# 严重性配置
severity:
  # 默认严重性
  default-severity: error

  # 规则严重性
  rules:
    - linters:
        - dupl
      severity: info
    - linters:
        - goconst
      severity: info
